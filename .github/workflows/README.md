# GitHub Actions –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

## üìã –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –¥–µ–ø–ª–æ—è –Ω–∞ VPS

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ VPS —Å–µ—Ä–≤–µ—Ä–∞

–í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –Ω–∞ –≤–∞—à–µ–º VPS:

```bash
# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∏—Å—Ç–µ–º—ã
sudo apt update && sudo apt upgrade -y

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Node.js 18.x
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ PM2
sudo npm install -g pm2

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Git
sudo apt install -y git

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞
sudo mkdir -p /var/www/artist-site
sudo chown -R $USER:$USER /var/www/artist-site

# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
cd /var/www
git clone https://github.com/averin-fn/artist-site.git
cd artist-site

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ PM2 –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞
pm2 startup
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –∫–æ–º–∞–Ω–¥—É, –∫–æ—Ç–æ—Ä—É—é –≤—ã–≤–µ–¥–µ—Ç PM2
```

### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–∞

–ù–∞ –≤–∞—à–µ–º –ª–æ–∫–∞–ª—å–Ω–æ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ –∏–ª–∏ VPS:

```bash
# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è SSH –∫–ª—é—á–∞ (–µ—Å–ª–∏ –µ—â–µ –Ω–µ—Ç)
ssh-keygen -t ed25519 -C "github-actions" -f ~/.ssh/github_actions

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞ –Ω–∞ VPS
ssh-copy-id -i ~/.ssh/github_actions.pub user@your-vps-ip

# –ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞ –¥–ª—è GitHub Secrets
cat ~/.ssh/github_actions
# –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –≤–µ—Å—å –≤—ã–≤–æ–¥ (–≤–∫–ª—é—á–∞—è BEGIN –∏ END —Å—Ç—Ä–æ–∫–∏)
```

### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ GitHub Secrets

–ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–∞—à–µ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: `Settings` ‚Üí `Secrets and variables` ‚Üí `Actions` ‚Üí `New repository secret`

–°–æ–∑–¥–∞–π—Ç–µ —Å–ª–µ–¥—É—é—â–∏–µ —Å–µ–∫—Ä–µ—Ç—ã:

| Secret Name | –û–ø–∏—Å–∞–Ω–∏–µ | –ü—Ä–∏–º–µ—Ä |
|------------|----------|--------|
| `VPS_HOST` | IP –∞–¥—Ä–µ—Å –∏–ª–∏ –¥–æ–º–µ–Ω VPS | `123.45.67.89` –∏–ª–∏ `your-domain.com` |
| `VPS_USERNAME` | –ò–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è SSH | `root` –∏–ª–∏ `ubuntu` |
| `VPS_SSH_KEY` | –ü—Ä–∏–≤–∞—Ç–Ω—ã–π SSH –∫–ª—é—á | –°–æ–¥–µ—Ä–∂–∏–º–æ–µ `~/.ssh/github_actions` |
| `VPS_PORT` | SSH –ø–æ—Ä—Ç (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) | `22` (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) |
| `DEPLOY_PATH` | –ü—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É –Ω–∞ VPS | `/var/www/artist-site` |
| `JWT_SECRET` | –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á JWT | –î–ª–∏–Ω–Ω–∞—è —Å–ª—É—á–∞–π–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (64+ —Å–∏–º–≤–æ–ª–æ–≤) |
| `ADMIN_USERNAME` | –ò–º—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ | `admin` |
| `ADMIN_PASSWORD` | –ü–∞—Ä–æ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ | –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π –ø–∞—Ä–æ–ª—å |

#### –ì–µ–Ω–µ—Ä–∞—Ü–∏—è JWT_SECRET:

```bash
# Linux/Mac
openssl rand -base64 64

# PowerShell (Windows)
-join ((48..57) + (65..90) + (97..122) | Get-Random -Count 64 | % {[char]$_})
```

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Nginx (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è –ø—Ä–æ–∫—Å–∏—Ä–æ–≤–∞–Ω–∏—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Nginx
sudo apt install -y nginx

# –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nano /etc/nginx/sites-available/artist-site
```

–î–æ–±–∞–≤—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é:

```nginx
server {
    listen 80;
    server_name your-domain.com;

    # Frontend
    location / {
        root /var/www/artist-site/dist;
        try_files $uri $uri/ /index.html;
        
        # –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ç–∞—Ç–∏–∫–∏
        location ~* \.(jpg|jpeg|png|gif|ico|css|js)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }

    # Backend API
    location /api {
        proxy_pass http://localhost:3001;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # Admin panel
    location /admin {
        proxy_pass http://localhost:3001/admin;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }

    # –ó–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã
    location /uploads {
        alias /var/www/artist-site/public/uploads;
        expires 1y;
        add_header Cache-Control "public, immutable";
    }

    # –ó–∞—â–∏—Ç–∞ —Ñ–∞–π–ª–æ–≤
    location ~ /\. {
        deny all;
    }
}
```

–ê–∫—Ç–∏–≤–∞—Ü–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏:

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ —Å–∏–º–ª–∏–Ω–∫–∞
sudo ln -s /etc/nginx/sites-available/artist-site /etc/nginx/sites-enabled/

# –£–¥–∞–ª–µ–Ω–∏–µ default –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
sudo rm /etc/nginx/sites-enabled/default

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
sudo nginx -t

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Nginx
sudo systemctl restart nginx
```

### 5. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSL —Å Let's Encrypt (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Certbot
sudo apt install -y certbot python3-certbot-nginx

# –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–∞
sudo certbot --nginx -d your-domain.com -d www.your-domain.com

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sudo certbot renew --dry-run
```

### 6. –ü–µ—Ä–≤—ã–π –¥–µ–ø–ª–æ–π

```bash
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ VPS
cd /var/www/artist-site

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π –≤—Ä—É—á–Ω—É—é (–ø–µ—Ä–≤—ã–π —Ä–∞–∑)
npm ci
npm run build

cd server
npm ci
npm run init-db

# –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ PM2
pm2 start server.js --name artist-site-backend --time
pm2 save
```

### 7. –ó–∞–ø—É—Å–∫ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

–ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–µ–∫—Ä–µ—Ç–æ–≤, –ø—Ä–æ—Å—Ç–æ —Å–¥–µ–ª–∞–π—Ç–µ push –≤ –≤–µ—Ç–∫—É `main`:

```bash
git add .
git commit -m "Deploy to production"
git push origin main
```

GitHub Actions –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
1. –°–æ–±–µ—Ä–µ—Ç frontend
2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ backend
3. –ü–æ–¥–∫–ª—é—á–∏—Ç—Å—è –∫ VPS –ø–æ SSH
4. –û–±–Ω–æ–≤–∏—Ç –∫–æ–¥ –∏–∑ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
5. –°–æ–∑–¥–∞—Å—Ç –±—ç–∫–∞–ø –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
6. –ü–µ—Ä–µ—Å–æ–±–µ—Ä–µ—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
7. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç PM2 –ø—Ä–æ—Ü–µ—Å—Å

### 8. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ VPS

```bash
# –°—Ç–∞—Ç—É—Å PM2 –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
pm2 status

# –õ–æ–≥–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 logs artist-site-backend

# –õ–æ–≥–∏ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 100 —Å—Ç—Ä–æ–∫
pm2 logs artist-site-backend --lines 100

# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
pm2 monit

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
pm2 restart artist-site-backend
```

### 9. –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

```bash
cd /var/www/artist-site

# –ü—Ä–æ—Å–º–æ—Ç—Ä –∫–æ–º–º–∏—Ç–æ–≤
git log --oneline -10

# –û—Ç–∫–∞—Ç –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É –∫–æ–º–º–∏—Ç—É
git reset --hard <commit-hash>

# –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞
npm ci && npm run build
cd server && npm ci

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
pm2 restart artist-site-backend
```

### 10. –ë—ç–∫–∞–ø—ã –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

```bash
# –°–æ–∑–¥–∞–Ω–∏–µ cron –∑–∞–¥–∞—á–∏ –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏—Ö –±—ç–∫–∞–ø–æ–≤
crontab -e

# –î–æ–±–∞–≤—å—Ç–µ —Å—Ç—Ä–æ–∫—É (–±—ç–∫–∞–ø –∫–∞–∂–¥—ã–π –¥–µ–Ω—å –≤ 3:00):
0 3 * * * cp /var/www/artist-site/server/artist.db /var/www/artist-site/backups/artist_$(date +\%Y\%m\%d).db

# –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –±—ç–∫–∞–ø–æ–≤ (—Å—Ç–∞—Ä—à–µ 30 –¥–Ω–µ–π)
0 4 * * * find /var/www/artist-site/backups -name "artist_*.db" -mtime +30 -delete
```

## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

1. **Firewall (UFW)**:
```bash
sudo ufw allow OpenSSH
sudo ufw allow 'Nginx Full'
sudo ufw enable
```

2. **Fail2Ban** (–∑–∞—â–∏—Ç–∞ –æ—Ç –±—Ä—É—Ç—Ñ–æ—Ä—Å–∞):
```bash
sudo apt install -y fail2ban
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏**:
```bash
# –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
sudo apt install -y unattended-upgrades
sudo dpkg-reconfigure --priority=low unattended-upgrades
```

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

- Frontend: `http://your-domain.com`
- Backend API: `http://your-domain.com/api`
- Admin panel: `http://your-domain.com/admin`
- PM2 status: `pm2 status`
- Nginx logs: `sudo tail -f /var/log/nginx/access.log`
- App logs: `pm2 logs artist-site-backend`

## üÜò Troubleshooting

**–ü—Ä–æ–±–ª–µ–º–∞**: PM2 –ø—Ä–æ—Ü–µ—Å—Å –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è
```bash
cd /var/www/artist-site/server
node server.js  # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä—è–º–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
```

**–ü—Ä–æ–±–ª–µ–º–∞**: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è
```bash
cd /var/www/artist-site/server
npm run init-db
```

**–ü—Ä–æ–±–ª–µ–º–∞**: 502 Bad Gateway –≤ Nginx
```bash
pm2 status  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å backend
sudo nginx -t  # –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é nginx
```
